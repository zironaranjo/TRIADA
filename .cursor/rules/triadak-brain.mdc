---
description: TRIADAK project brain - architecture, progress, and roadmap
alwaysApply: true
---

# TRIADAK - Project Brain

## What is Triadak?
SaaS platform for **vacation rental management** (triadak.io). Combines features inspired by **Bexio** (accounting), **VRPlatform** (trust accounting), and **Lodgify** (channel manager/PMS) into one unified platform.

## Tech Stack
- **Frontend**: React + Vite + TypeScript + Tailwind CSS + Framer Motion
- **Backend**: NestJS (currently minimal, most logic direct to Supabase)
- **Database/Auth/Storage**: Supabase (PostgreSQL + Auth + Storage + RLS)
- **Charts**: Recharts
- **Email**: Resend (via NestJS endpoint)
- **Deployment**: Docker + CI/CD (GitHub push triggers build)
- **Language**: Always respond in Spanish to the user

## Architecture
- Frontend connects **directly to Supabase** for most CRUD (properties, bookings, contacts, etc.)
- Backend NestJS used for email sending, webhooks, sync endpoints
- Row Level Security (RLS) enabled for multi-tenancy
- Supabase Storage bucket `property-images` for property images AND avatars (avatars/{userId}/)
- Notifications use `createPortal` to render outside sidebar (avoids overflow clipping)
- Supabase Realtime for live notification updates

## Database Tables
- `properties` - Vacation rental properties (name, status, images, etc.)
- `bookings` - Reservations (guest_name, start_date, end_date, total_price, platform, status, property_id)
- `contacts` - CRM contacts
- `owners` - Property owners
- `ledger_entries` - Accounting entries
- `notifications` - In-app notifications (user_id, type, title, message, read, metadata, created_at) + RLS + DB trigger on booking insert
- `profiles` - User profiles (user_id, email, full_name, role)
- `subscriptions` - User subscription plans

## Completed Features
1. **Auth** - Supabase Auth with email verification, forgot password
2. **Properties CRUD** - Create, edit, delete properties with image upload to Supabase Storage
3. **Bookings CRUD** - Full booking management with list and calendar tab views
4. **Visual Calendar** - Integrated into Bookings page as tab (monthly view, mobile dots, stats)
5. **CRM/Contacts** - Contact management
6. **Owners** - Owner management
7. **Accounting/Ledger** - Basic ledger entries
8. **Dashboard Analytics** - Real data from Supabase: monthly revenue chart (AreaChart), platform distribution (PieChart), revenue by property (BarChart horizontal), occupancy progress bars, upcoming bookings list
9. **Landing Page** - Professional public page at / with hero, features, pricing, testimonials, FAQ
10. **Mobile Responsive** - Full responsive layout with hamburger menu sidebar
11. **Onboarding** - Empty state guides for new users
12. **Email Confirmation** - Booking confirmation emails via Resend
13. **Multi-tenancy/RLS** - Row Level Security in Supabase
14. **Settings Page** - Profile (avatar upload, name, phone, company), Preferences (language, currency, timezone, theme selector), Notifications (toggle switches for email/bookings/payments/reminders), Danger Zone (password reset, delete account). Saves to Supabase (profile) + localStorage (preferences)
15. **Notification Center** - Bell icon in mobile header + desktop sidebar, portal-based dropdown panel with realtime updates, read/unread indicators, mark all read, clear all, delete individual, auto-notifications via DB trigger on booking insert
16. **Owner Statements** - Monthly settlement reports per owner: gross revenue, platform fees, agency commission, expenses, net payout. Expandable detail with bookings and expenses breakdown
17. **PDF/CSV Export** - Professional PDF reports (jspdf + jspdf-autotable) and CSV export for Owner Statements and Finance Dashboard. Branded with TRIADAK header, summary section, and paginated tables

## Pending / Roadmap (next priorities in order)
- [ ] Multi-language support (i18n with react-i18next) - ready to implement, structure defined
- [ ] Scheduled email notifications (cron for check-in/out reminders - needs backend/edge function)
- [ ] Stripe payment integration (deferred by user)
- [x] Finance dashboard (improved with responsive layout, filters, export buttons)
- [x] Owner Statements (monthly settlement reports with PDF/CSV export)
- [ ] Airbnb API integration
- [ ] Booking.com API integration
- [ ] Lodgify integration (channel manager sync)
- [x] Advanced reports (exportable PDF/CSV with jspdf)
- [ ] Owner portal (owners can view their property performance)

## Key Files
- `frontend/src/App.tsx` - Main routing (public: /, /login; protected: /dashboard, /properties, /bookings, /owners, /crm, /accounting, /pricing, /billing, /settings)
- `frontend/src/components/Layout.tsx` - App shell with sidebar + mobile menu + NotificationCenter
- `frontend/src/components/NotificationCenter.tsx` - Bell icon + portal dropdown with realtime notifications
- `frontend/src/pages/Dashboard.tsx` - Analytics dashboard with real Recharts graphs
- `frontend/src/pages/Bookings.tsx` - Bookings list + calendar tab view
- `frontend/src/pages/Properties.tsx` - Property CRUD + image upload
- `frontend/src/pages/Settings.tsx` - User settings (profile, preferences, notifications, danger zone)
- `frontend/src/pages/LandingPage.tsx` - Public landing page
- `frontend/src/contexts/AuthContext.tsx` - Auth provider with profile, subscription, role management
- `frontend/src/pages/OwnerStatements.tsx` - Monthly owner settlement reports
- `frontend/src/lib/supabase.ts` - Supabase client config
- `frontend/src/lib/exportUtils.ts` - PDF/CSV export utilities (jspdf + jspdf-autotable)

## Conventions
- Use Supabase direct queries (not backend API) for frontend CRUD
- Tailwind for all styling, dark theme (bg-[#0f172a] base)
- Framer Motion for animations
- GlassCard component for card UI
- Mobile-first responsive: use `sm:`, `md:`, `lg:` breakpoints
- PowerShell terminal: do NOT chain commands with `&&`, run them separately
- Production build is strict TypeScript: remove ALL unused imports/variables (TS6133 errors break Docker build)
- Supabase Storage: use `property-images` bucket for all uploads (property images + avatars)

## Known Issues / Notes
- Docker build uses strict `tsc -b` which fails on unused imports (always clean up)
- Avatar upload uses `property-images` bucket with path `avatars/{userId}/avatar.{ext}`
- Notification panel uses `createPortal(... , document.body)` to avoid sidebar overflow clipping
- Settings preferences (language, currency, etc.) saved to localStorage until i18n is fully implemented
